Настройка этапов документа
==============================

Основная логика проекта настраивается в этапах проекта. **Этапы** - это состояния, в которых находится объект бизнесс процесса. Документ может переходить с этапа на этап линейно,
пропускать этапы или двигаться по разным этапам в зависимости от его параметров. Инструменты настройки этапов позволяют максимально точно настроить бизнесс процесс и автоматизировать управление передачи и изменения данных в БП.

Файлы конфигурации этапов представляют из себя *XML-документы* и находится папке workflow корневой директории проекта:

``..bps/projects/<ИМЯ_ПРОЕКТА>/workflow/``

``
state1.xml, state2.xml...
``

Создайте в папке */workflow* для своего проекта необходимое количество xml файлов, с названиями **эквивалентными** названиям этапов.

Настройку этапа проекта можно разделить на несколько частей:

* `Настройка доступа к полям`_
* `Настройка доступа к таблицам`_
* `Настройка валидаторов`_
* `Настройка переходов`_


Настройка доступа к полям
------------------------------
Для настройки видимости и доступа к полям документа в конфигурационном файле создайте блок ``<field_access></field_access>`` (блок доступа к полям).

Для управления доступом к полям в блоке *field_access* могут находиться два блока ``<read></read>``(поля с доступом на чтение) и  ``<edit></edit>``(поля с доступом на редактирование). Пример структуры блока field_access:

.. code-block:: xml
    <field_access>
        <edit>
            field_1, field_2
        </edit>
        <read>
          field_3, field_4
        </read>
    </field_access>


В данном примере показана настройка разрешения на чтение для всех пользователей полей *field_3* и *field_4* и доступа на редактирование для всех пользователей полей *field_1* и *field_2*, остальные поля документа (если таковые есть) будут скрыты. Блоков *field_access* в конфигурационном файле этапа может быть несколько, и они могут *переопределять доступ к полям*.

Для более точной настройки доступа к полям можно использовать **Валидаторы**:

.. code-block:: xml
    <field_access>
        <validator>
            <field_1 rule="equal">True</object_type>
        </validator>
        <edit>
            field_3
        </edit>
    </field_access>

Блок валидотор добавляет условие применения блока *<field_access>*. В данном примере поле *field_3* будет доступно на редактирование только в случае если поле документа *field_1* содержит значение True. Валидаторы могут использовать для проверки не только поля документа, но и например роль текущего оператора или даже автоматически генерируемое значение.
ПОдробнее о валидаторах можно узнать в разделе :doc:`"Валидаторы" </customizing/bps/validators>`



Настройка доступа к таблицам
--------------------------------
